datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id                               String    @id @default(uuid())
  lastname                         String
  firstname                        String
  email                            String    @unique @db.VarChar(320)
  token                            String?
  phone_number                     String?
  is_cgu_accepted                  Boolean   @default(false)
  is_vgcl_accepted                 Boolean   @default(false)
  theme_mode                       String    @default("system")
  created_at                       DateTime  @default(now())
  updated_at                       DateTime  @updatedAt
  registered_at                    DateTime  @default(now())
  is_email_verified                Boolean   @default(false)
  email_verification_token         String?
  email_verification_token_expires DateTime?

  passwordHistory   PasswordHistory[]
  loginHistory      LoginHistory[]
  roles             UserRole[]     
}

model PasswordHistory {
  id         String   @id @default(uuid())
  password   String
  created_at DateTime @default(now())
  user_id    String
  user       User     @relation(fields: [user_id], references: [id])
}

model LoginHistory {
  id   String   @id @default(uuid())
  date DateTime @default(now())

  user_id String
  ip_v4   String?
  ip_v6   String?

  user User @relation(fields: [user_id], references: [id])
}

model Role {
  id    String @id @default(uuid())
  name  String @unique
  power Int    @default(1)

  users UserRole[]
}

model UserRole {
  id      String @id @default(uuid())
  role_id String
  user_id String

  role Role @relation(fields: [role_id], references: [id])
  user User @relation(fields: [user_id], references: [id])
}
